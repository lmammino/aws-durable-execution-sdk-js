# This workflow will do a clean installation of node dependencies, cache/restore them, build the source code and run tests across different versions of node
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-nodejs

name: Unit Tests

on:
  push:
    branches: [ "main", "development"]
  pull_request:
    branches: [ "main", "development"]

# Cancel old jobs when a pull request is updated.
concurrency:
    group: ${{ github.head_ref || github.run_id }}
    cancel-in-progress: true

jobs:
  lint-commits:
      # Note: To re-run `lint-commits` after fixing the PR title, close-and-reopen the PR.
      runs-on: ubuntu-latest
      steps:
          - uses: actions/checkout@v4
          - name: Use Node.js ${{ matrix.node-version }}
            uses: actions/setup-node@v4
            with:
              node-version: ${{ matrix.node-version }}
              cache: 'npm'
          - name: Check PR title
            run: |
                node "$GITHUB_WORKSPACE/.github/workflows/lintcommit.js"

  build:
    needs: lint-commits

    runs-on: ubuntu-latest

    strategy:
      matrix:
        node-version: [22.x]
        # See supported Node.js release schedule at https://nodejs.org/en/about/releases/

    steps:
    - uses: actions/checkout@v4
    - name: Use Node.js ${{ matrix.node-version }}
      uses: actions/setup-node@v4
      with:
        node-version: ${{ matrix.node-version }}
        cache: 'npm'
    - run: npm run install-all
    - run: npm run build
    - run: npm run test
