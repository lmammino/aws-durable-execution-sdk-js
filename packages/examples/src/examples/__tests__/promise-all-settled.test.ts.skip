import { LocalDurableTestRunner} from "@amzn/durable-executions-type-script-testing-library";
import { handler } from '../promise-all-settled';

beforeAll(() => LocalDurableTestRunner.setupTestEnvironment());
afterAll(() => LocalDurableTestRunner.teardownTestEnvironment());

describe("promise-all-settled test", () => {
    const durableTestRunner = new LocalDurableTestRunner({
        handlerFunction: handler,
        skipTime: true,
    });

    it("should complete all promises", async () => {
       const execution = await durableTestRunner.run();

       expect(execution.getCompletedOperations()).toHaveLength(4)
        console.log(execution.getResult());
    });

    it("should return expected result", async () => {
        const execution = await durableTestRunner.run();

        const result = execution.getResult() as PromiseSettledResult<any>[];

        expect(result.filter(e => e.status! === "fulfilled")).toHaveLength(2);
        expect(result.filter(e => e.status! === "rejected")).toHaveLength(1);
    });
});